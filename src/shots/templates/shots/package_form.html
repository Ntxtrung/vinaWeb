{% extends 'base.html' %}

{% load widget_tweaks %}
{% load form_tags %}
{% load static %}

{% block scripts %}
  {{ block.super }}
  <script src="{% static 'js/form_undo.js' %}" defer></script>
  <script src="{% static 'js/form_package.js' %}" defer></script>
{% endblock scripts %}

{% block content %}
<!-- Tạo mới Package -->
<h1 class="text-2xl font-bold mb-4 dark:text-white">Create New Package</h1>
<form method="post" action="" class="bg-white dark:bg-gray-800 p-6 rounded shadow-md">
  {% csrf_token %}

  {% if package_form.non_field_errors %}
  <div class="alert alert-danger">
      {{ package_form.non_field_errors }}
  </div>
  {% endif %}

  <h2 class="text-xl font-semibold mb-2 dark:text-gray-300">Project Details</h2>
  <div class="mb-4 space-y-4">
    {{ project_form.non_field_errors }}
    <div class="dark:text-white">
      {{ project_form.project_name.label_tag }}<br>
      {{ project_form.project_name }}
      {{ project_form.project_name.errors }}
    </div>
    <div class="dark:text-white">
      {{ project_form.client.label_tag }}<br>
      {{ project_form.client }}
      {{ project_form.client.errors }}
    </div>
  </div>

  <h2 class="text-xl font-semibold mb-2 dark:text-gray-300">Package Details</h2>
  <div class="mb-4 space-y-4">
    {{ package_form.non_field_errors }}
    <div class="dark:text-white">
      {{ package_form.package_name.label_tag }}<br>
      {{ package_form.package_name }}
      {{ package_form.package_name.errors }}
    </div>
  </div>

  <div class="mb-4">
    <label for="bulk-delivery-date" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Set Delivery Date for All Shots:</label>
    <input type="date" id="bulk-delivery-date" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50">
    <button type="button" id="apply-bulk-date" class="mt-2 px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">Apply to All Shots</button>
  </div>

  <!-- Shot formset -->
  {{ shot_formset.management_form }}
  <table id="shot-table" class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
    <thead class="bg-gray-50 dark:bg-gray-800">
      <tr>
        {% for field in shot_formset.forms.0 %}
          {% if field.label != 'Delete' and not field.is_hidden %}
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">{{ field.label }}</th>
          {% endif %}
        {% endfor %}
        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Actions</th>
      </tr>
    </thead>
    <tbody class="bg-white divide-y divide-gray-200 dark:bg-gray-900 dark:divide-gray-700">
      {% for form in shot_formset %}
        <tr>
          {% for field in form.visible_fields %}
            <td class="px-6 py-4 whitespace-nowrap">
              {% if field.name == 'DELETE' %}
                <button type="button" class="delete-row text-red-600 hover:text-red-900">Delete</button>
              {% else %}
                {{ field|add_class:"form-input rounded-md shadow-sm mt-1 block w-full" }}
              {% endif %}
              {{ field.errors }}
            </td>
          {% endfor %}
          {% for hidden in form.hidden_fields %}
            {{ hidden }}
          {% endfor %}
        </tr>
      {% endfor %}
    </tbody>
  </table>

  <div class="mt-4">
    <button type="submit" class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">Save Package</button>
  </div>
</form>
{% endblock content %}